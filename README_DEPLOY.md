# ‚úÖ –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é –Ω–∞ Ubuntu VPS

## üéØ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ‚úÖ SSR –¥–ª—è –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –¥–≤—É–º—è –¥–æ–º–µ–Ω–∞–º–∏
- **Next.js SSR** —Ä–µ–∂–∏–º (`output: 'standalone'`)
- **Middleware** –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤
- **–û–¥–∏–Ω Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç –æ–±–∞ –¥–æ–º–µ–Ω–∞

### ‚úÖ SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –†–∞–∑–Ω—ã–µ –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ–º–µ–Ω–∞
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ canonical URLs
- Host-aware robots.txt –∏ sitemap.xml
- Schema.org —Ä–∞–∑–º–µ—Ç–∫–∞ –¥–ª—è –æ–±–æ–∏—Ö –≥–æ—Ä–æ–¥–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ 301 —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã (–±–µ–∑ –¥—É–±–ª–µ–π)

### ‚úÖ –†–∞–∑–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏
- **–•–∞–±–∞—Ä–æ–≤—Å–∫**: `NEXT_PUBLIC_YANDEX_METRIKA_ID_KHABAROVSK`
- **–ò—Ä–∫—É—Ç—Å–∫**: `NEXT_PUBLIC_YANDEX_METRIKA_ID_IRKUTSK`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ hostname

### ‚úÖ –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å –ø–æ–º–µ—Ç–∫–æ–π –≥–æ—Ä–æ–¥–∞
- –§–æ—Ä–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç –≥–æ—Ä–æ–¥ –≤ –ø–∏—Å—å–º–æ
- –†–∞–∑–Ω—ã–µ —Ü–µ–ª–∏ –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞
- –í–∏–∑—É–∞–ª—å–Ω–∞—è –º–µ—Ç–∫–∞ "–ó–∞—è–≤–∫–∞ –∏–∑ –ò—Ä–∫—É—Ç—Å–∫" –≤ —Ñ–æ—Ä–º–µ

### ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
- Docker –æ–±—Ä–∞–∑ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ Node.js (1 GB –¥–ª—è 2 GB VPS)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏ –≤ Nginx

---

## üì¶ –§–∞–π–ª—ã –¥–ª—è –¥–µ–ø–ª–æ—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `Dockerfile` - –º–Ω–æ–≥–æ—Å—Ç–∞–¥–∏–π–Ω–∞—è —Å–±–æ—Ä–∫–∞
- ‚úÖ `.dockerignore` - –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ `docker-compose.yml` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- ‚úÖ `nginx.conf` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx —Å –ø–µ—Ä–µ–¥–∞—á–µ–π Host
- ‚úÖ `deploy.sh` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
- ‚úÖ `env.production.example` - –ø—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- ‚úÖ `DEPLOY.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- ‚úÖ `QUICK_DEPLOY.md` - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- ‚úÖ `VPS_SETUP.md` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ VPS

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π (5 —à–∞–≥–æ–≤)

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É**
   ```bash
   ssh root@85.209.9.193
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker** (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
   ```bash
   curl -fsSL https://get.docker.com -o get-docker.sh && sh get-docker.sh
   ```

3. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç**
   ```bash
   cd /opt
   git clone <–≤–∞—à-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π> bst-hab
   cd bst-hab
   ```

4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**
   ```bash
   cp env.production.example .env.production
   nano .env.production  # –£–∫–∞–∂–∏—Ç–µ ID —Å—á—ë—Ç—á–∏–∫–æ–≤ –ú–µ—Ç—Ä–∏–∫–∏!
   ```

5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–µ–ø–ª–æ–π**
   ```bash
   chmod +x deploy.sh
   ./deploy.sh
   ```

6. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx**
   ```bash
   sudo cp nginx.conf /etc/nginx/sites-available/bst-hab
   sudo ln -s /etc/nginx/sites-available/bst-hab /etc/nginx/sites-enabled/
   sudo nginx -t && sudo systemctl restart nginx
   ```

7. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ DNS** (–≤ –ø–∞–Ω–µ–ª–∏ –¥–æ–º–µ–Ω–∞)
   - `bst-hab.ru` ‚Üí `A @ -> 85.209.9.193`
   - `irkutsk.bst-hab.ru` ‚Üí `A irkutsk -> 85.209.9.193`

8. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ SSL**
   ```bash
   sudo apt install certbot python3-certbot-nginx -y
   sudo certbot --nginx -d bst-hab.ru -d www.bst-hab.ru -d irkutsk.bst-hab.ru
   ```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –û—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω
curl -H "Host: bst-hab.ru" http://localhost:3000

# –ü–æ–¥–¥–æ–º–µ–Ω
curl -H "Host: irkutsk.bst-hab.ru" http://localhost:3000

# –°—Ç–∞—Ç—É—Å
docker-compose ps
docker-compose logs -f
```

---

## üìä –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

‚úÖ **bst-hab.ru** ‚Üí –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç (–•–∞–±–∞—Ä–æ–≤—Å–∫)  
‚úÖ **irkutsk.bst-hab.ru** ‚Üí –ø–æ–¥–¥–æ–º–µ–Ω (–ò—Ä–∫—É—Ç—Å–∫)  
‚úÖ **–†–∞–∑–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏ –ú–µ—Ç—Ä–∏–∫–∏** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ–º–µ–Ω–∞  
‚úÖ **–†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º—ã** —Å –ø–æ–º–µ—Ç–∫–æ–π –≥–æ—Ä–æ–¥–∞ –≤ –ø–∏—Å—å–º–∞—Ö  
‚úÖ **SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** –¥–ª—è –æ–±–æ–∏—Ö –¥–æ–º–µ–Ω–æ–≤  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã** (–±–µ–∑ –¥—É–±–ª–µ–π)  
‚úÖ **–û–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** –¥–ª—è –æ–±–æ–∏—Ö –¥–æ–º–µ–Ω–æ–≤  

---

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤ `.env.production`:**

```env
# –ú–µ—Ç—Ä–∏–∫–∞ (—Ä–∞–∑–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏!)
NEXT_PUBLIC_YANDEX_METRIKA_ID_KHABAROVSK=–≤–∞—à_id_—Ö–∞–±–∞—Ä–æ–≤—Å–∫
NEXT_PUBLIC_YANDEX_METRIKA_ID_IRKUTSK=–≤–∞—à_id_–∏—Ä–∫—É—Ç—Å–∫

# –î–æ–º–µ–Ω—ã
NEXT_PUBLIC_SITE_URL=https://bst-hab.ru
NEXT_PUBLIC_MAIN_DOMAIN=https://bst-hab.ru
NEXT_PUBLIC_IRKUTSK_DOMAIN=https://irkutsk.bst-hab.ru

# EmailJS (—É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤ –ø—Ä–∏–º–µ—Ä–µ)
NEXT_PUBLIC_EMAILJS_SERVICE_ID=service_gqs4iac
NEXT_PUBLIC_EMAILJS_USER_ID=f4bypjKBcjk0x5flD
NEXT_PUBLIC_EMAILJS_CALLBACK_TEMPLATE_ID=template_7m3oi59
NEXT_PUBLIC_EMAILJS_CONTACT_TEMPLATE_ID=template_ojm435x
```

---

## üÜò –ü—Ä–æ–±–ª–µ–º—ã?

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:**
```bash
docker-compose logs
docker-compose down && docker-compose build --no-cache && docker-compose up -d
```

**–ü–æ–¥–¥–æ–º–µ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–¥–∞—á—É `Host` –≤ Nginx (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `proxy_set_header Host $host;`)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS: `dig irkutsk.bst-hab.ru`

**–ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏:**
```bash
docker stats
free -h
```

---

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
bst_hab/
‚îú‚îÄ‚îÄ Dockerfile              # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
‚îú‚îÄ‚îÄ nginx.conf              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
‚îú‚îÄ‚îÄ deploy.sh               # –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è
‚îú‚îÄ‚îÄ env.production.example  # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ middleware.ts           # –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx          # –ì–ª–∞–≤–Ω—ã–π layout (host-aware)
‚îÇ   ‚îú‚îÄ‚îÄ irkutsk/            # –°—Ç—Ä–∞–Ω–∏—Ü—ã –ò—Ä–∫—É—Ç—Å–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ robots.txt/        # Host-aware robots.txt
‚îî‚îÄ‚îÄ components/
    ‚îú‚îÄ‚îÄ shared/
    ‚îÇ   ‚îú‚îÄ‚îÄ metrika.ts      # –í—ã–±–æ—Ä —Å—á—ë—Ç—á–∏–∫–∞ –ø–æ host
    ‚îÇ   ‚îî‚îÄ‚îÄ YandexMetrika.tsx # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ú–µ—Ç—Ä–∏–∫–∏
    ‚îî‚îÄ‚îÄ features/
        ‚îî‚îÄ‚îÄ ContactForm.tsx # –§–æ—Ä–º–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≥–æ—Ä–æ–¥–∞
```

---

**–ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é!** üöÄ

–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ `QUICK_DEPLOY.md` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞.

